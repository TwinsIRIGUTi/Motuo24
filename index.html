<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>モツオ24</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: "Kosugi Maru", sans-serif;
      margin: 0;
      padding: 0;
    }
    canvas {
      background: #111;
      display: block;
      border-radius: 6px;
    }
    #scoreDisplay, #wordDisplay, #controls, #timeDisplay {
      margin: 10px;
      font-size: 1.2em;
      text-align: center;
    }
    #startScreen {
      display: block;
      text-align: center;
      margin-top: 50px;
    }
    #gameUI {
      display: none;
      text-align: center;
    }
    button {
      font-size: 1.1em;
      margin: 5px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #333;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #555;
    }
    #gameArea {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      margin-top: 10px;
    }
    #wordList {
      width: 180px;
      background: #111;
      color: #fff;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
    }
    #wordList ul {
      list-style: square;
      padding-left: 16px;
    }
    .wordEffect {
      font-size: 32px;
      color: gold;
      text-align: center;
      margin: 10px auto;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>モツオ24</h1>
    <button onclick="startGame(3)">3分モード</button>
    <button onclick="startGame(5)">5分モード</button>
    <button onclick="startGame('endless')">エンドレスモード</button>
  </div>

  <div id="gameUI">
    <div id="scoreDisplay">スコア: 0</div>
    <div id="timeDisplay"></div>
    <div id="wordDisplay"></div>

    <div id="gameArea">
      <canvas id="game" width="500" height="500" tabindex="0"></canvas>
      <div id="wordList">
        <h3>成立単語</h3>
        <ul>
          <li>シロ</li><li>レバ</li><li>ガツ</li><li>ツル</li><li>ホネ</li><li>ハツ</li>
          <li>アブラ</li><li>カシラ</li><li>ビール</li><li>ニコミ</li><li>シンキ</li><li>ウメワリ</li>
          <li>サイダー</li><li>タンナマ</li><li>オシンコ</li><li>ダイコン</li><li>ナンコツ</li><li>コブクロ</li>
          <li>ブドウワリ</li><li>ウイスキー</li><li>ツインズ</li>
        </ul>
      </div>
    </div>

    <div id="controls">
      <button onclick="togglePause()" id="pauseBtn">一時停止</button>
      <button onclick="endGame()">終了</button>
      <button onclick="reloadBoard()">リロード</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const BLOCK_SIZE = 100;
    const GRID_SIZE = 5;
    const EMPTY = null;
    let board = [];
    let score = 0;
    let gameInterval;
    let remainingTime;
    let isPaused = false;
    let frameCount = 0;
    let cursor = { x: 0, y: 0 };

    const kanaList = [..."シ,ロ,レ,バ,ガ,ツ,ホ,ハ,ア,ブ,ラ,カ,シ,ラ,ビ,ー,ル,ニ,コ,ミ,ウ,メ,ワ,リ,ド,ウ,サ,イ,ダ,ー,キ,ン,オ,シ,ン,コ,ダ,イ,ン,ツ,ズ".split(",")];
    const words = [
      "シロ", "レバ", "ガツ", "コブクロ", "ナンコツ", "アブラ",
      "ハツ", "カシラ", "ビール", "ウメワリ", "ブドウワリ",
      "ウイスキー", "サイダー", "ツル", "シンキ", "タンナマ",
      "オシンコ", "ダイコン", "ニコミ", "ホネ", "ツインズ"
    ];

    function getRandomKana() {
      return kanaList[Math.floor(Math.random() * kanaList.length)];
    }

    function createBlock() {
      return { char: getRandomKana() };
    }

    function initBoard() {
      board = [];
      for (let y = 0; y < GRID_SIZE; y++) {
        const row = [];
        for (let x = 0; x < GRID_SIZE; x++) {
          row.push((x === 0 && y === 0) ? EMPTY : createBlock());
        }
        board.push(row);
      }
      cursor = { x: 0, y: 0 };
    }

    function reloadBoard() {
      for (let y = 0; y < GRID_SIZE; y++) {
        for (let x = 0; x < GRID_SIZE; x++) {
          board[y][x] = (x === 0 && y === 0) ? EMPTY : createBlock();
        }
      }
    }

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < GRID_SIZE; y++) {
        for (let x = 0; x < GRID_SIZE; x++) {
          const block = board[y][x];
          ctx.fillStyle = block ? "#fff5cc" : "#111";
          ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE - 2, BLOCK_SIZE - 2);
          if (block) {
            ctx.fillStyle = "#000";
            ctx.font = "48px Kosugi Maru";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(block.char, x * BLOCK_SIZE + BLOCK_SIZE / 2, y * BLOCK_SIZE + BLOCK_SIZE / 2);
          }
        }
      }
      ctx.strokeStyle = "red";
      ctx.lineWidth = 4;
      ctx.strokeRect(cursor.x * BLOCK_SIZE, cursor.y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
    }

    function updateScore(points) {
      score += points;
      document.getElementById('scoreDisplay').textContent = `スコア: ${score}`;
    }

    function updateTimeDisplay() {
      const timeDisplay = document.getElementById('timeDisplay');
      if (typeof remainingTime === 'number') {
        const minutes = Math.floor(remainingTime / 60);
        const seconds = remainingTime % 60;
        timeDisplay.textContent = `残り時間: ${minutes}:${seconds.toString().padStart(2, '0')}`;
      } else {
        timeDisplay.textContent = "エンドレスモード";
      }
    }

    function showWordEffect(foundWords) {
      const display = document.getElementById('wordDisplay');
      display.innerHTML = foundWords.map(w => `<div class="wordEffect">${w}</div>`).join('');
      setTimeout(() => {
        display.innerHTML = '';
      }, 1500);
    }

    function checkWords() {
      let foundWords = [];
      let positionsToClear = [];

      for (let y = 0; y < GRID_SIZE; y++) {
        let line = "";
        for (let x = 0; x < GRID_SIZE; x++) {
          line += board[y][x] ? board[y][x].char : "";
        }
        for (const word of words) {
          const idx = line.indexOf(word);
          if (idx !== -1) {
            foundWords.push(word);
            for (let i = 0; i < word.length; i++) {
              positionsToClear.push({ x: idx + i, y });
            }
          }
        }
      }

      for (let x = 0; x < GRID_SIZE; x++) {
        let line = "";
        for (let y = 0; y < GRID_SIZE; y++) {
          line += board[y][x] ? board[y][x].char : "";
        }
        for (const word of words) {
          const idx = line.indexOf(word);
          if (idx !== -1) {
            foundWords.push(word);
            for (let i = 0; i < word.length; i++) {
              positionsToClear.push({ x, y: idx + i });
            }
          }
        }
      }

      if (foundWords.length > 0) {
        foundWords = [...new Set(foundWords)];
        for (const word of foundWords) updateScore(word.length * 10);
        for (const pos of positionsToClear) {
          board[pos.y][pos.x] = createBlock();
        }
        showWordEffect(foundWords);
      }
    }

    function startGame(mode) {
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("gameUI").style.display = "block";
      initBoard();
      drawBoard();
      score = 0;
      frameCount = 0;
      isPaused = false;
      remainingTime = mode === 'endless' ? null : mode * 60;
      updateScore(0);
      updateTimeDisplay();
      clearInterval(gameInterval);
      gameInterval = setInterval(gameLoop, 1000 / 60);
      canvas.focus();
    }

    function togglePause() {
      isPaused = !isPaused;
      document.getElementById("pauseBtn").textContent = isPaused ? "再開" : "一時停止";
    }

    function endGame() {
      clearInterval(gameInterval);
      alert("ゲーム終了！スコア: " + score);
      document.getElementById("startScreen").style.display = "block";
      document.getElementById("gameUI").style.display = "none";
    }

    function gameLoop() {
      if (isPaused) return;
      frameCount++;
      if (frameCount % 60 === 0) {
        if (typeof remainingTime === "number") {
          remainingTime--;
          if (remainingTime <= 0) endGame();
        }
        updateTimeDisplay();
        checkWords();
      }
      drawBoard();
    }

    canvas.addEventListener("click", e => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left) / BLOCK_SIZE);
      const y = Math.floor((e.clientY - rect.top) / BLOCK_SIZE);

      let emptyX = -1, emptyY = -1;
      for (let j = 0; j < GRID_SIZE; j++) {
        for (let i = 0; i < GRID_SIZE; i++) {
          if (board[j][i] === EMPTY) {
            emptyX = i;
            emptyY = j;
            break;
          }
        }
        if (emptyX !== -1) break;
      }

      const dx = Math.abs(x - emptyX);
      const dy = Math.abs(y - emptyY);
      if ((dx === 1 && dy === 0) || (dx === 0 && dy === 1)) {
        board[emptyY][emptyX] = board[y][x];
        board[y][x] = EMPTY;
        cursor = { x: emptyX, y: emptyY };
      }
    });

    window.startGame = startGame;
    window.endGame = endGame;
    window.togglePause = togglePause;

    window.addEventListener("keydown", e => {
      if (isPaused) return;
      if (e.key === "ArrowLeft" && cursor.x < GRID_SIZE - 1) cursor.x++;
      if (e.key === "ArrowRight" && cursor.x > 0) cursor.x--;
      if (e.key === "ArrowUp" && cursor.y < GRID_SIZE - 1) cursor.y++;
      if (e.key === "ArrowDown" && cursor.y > 0) cursor.y--;
    });
  </script>
</body>
</html>
